<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Learn how to add annotations to onsets.
">
<title>Adding Annotations • onsetsync</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Adding Annotations">
<meta property="og:description" content="Learn how to add annotations to onsets.
">
<meta property="og:image" content="https://github.com/tuomaseerola/onsetsync/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">onsetsync</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/onsetsync.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/adding_annotations.html">Adding Annotations</a>
    <a class="dropdown-item" href="../articles/advanced_topics.html">Advanced topics</a>
    <a class="dropdown-item" href="../articles/analysis_example.html">Analysis Example</a>
    <a class="dropdown-item" href="../articles/analysis_of_periodicity.html">Analysis of periodicity</a>
    <a class="dropdown-item" href="../articles/minimal-representation.html">Minimal representation</a>
    <a class="dropdown-item" href="../articles/synthesise_onsets.html">Synthesise onsets</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Adding Annotations</h1>
            
      
      
      <div class="d-none name"><code>adding_annotations.Rmd</code></div>
    </div>

    
    
<p>Typically you have raw onset data when loading files with
<code>onsetsync</code> which might not any other information within them
(beat subdivisions, etc.). Here is an example of how you can add
reference beat subdivisions and calculate reference beats such as mean
of all onsets in a sub-division.</p>
<div class="section level2">
<h2 id="load-raw-onsets-from-osf">Load raw onsets from OSF<a class="anchor" aria-label="anchor" href="#load-raw-onsets-from-osf"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">onsetsync</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://httr.r-lib.org/" class="external-link">httr</a></span><span class="op">)</span></span>
<span><span class="va">CSS_Song2_Onset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_OSF_csv.html">get_OSF_csv</a></span><span class="op">(</span><span class="st">'8a347'</span><span class="op">)</span> <span class="co"># Get onsets</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">CSS_Song2_Onset</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">8</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    Piece Label.SD SD Clave_. Section Isochronous.SD.Time Clave     Bass</span></span>
<span><span class="co">## 1 Song_2      1|1  1       1     Son            5.037333    NA       NA</span></span>
<span><span class="co">## 2 Song_2      1|2  2       N     Son            5.260063    NA       NA</span></span>
<span><span class="co">## 3 Song_2      1|3  3       N     Son            5.482792    NA       NA</span></span>
<span><span class="co">## 4 Song_2      1|4  4       2     Son            5.705521    NA 5.714555</span></span>
<span><span class="co">## 5 Song_2      1|5  5       N     Son            5.928250    NA 5.927078</span></span>
<span><span class="co">## 6 Song_2      1|6  6       N     Son            6.150979    NA       NA</span></span></code></pre>
<p>The data frame shows a portion of the onset data structure where the
last three columns refer to the onset times of the specific instruments
(<code>Clave</code>, <code>Bass</code>, and <code>Guitar</code>). Note
that we only show the first eight columns and 6 rows. The first five
columns are <strong>meta-data</strong>, referring to the piece, beats
and cycles and sections. <code>Label.SD</code> combines cycle and beat
information (first integer refers to cycle and the second integer refers
to beat sub-division). <code>SD</code> represents the
<em>sub-division</em> explicitly. In this music there are 16
subdivisions per cycle (which can be felt as 4 beats <span class="math inline">\(\times\)</span> 4 subdivisions).
<code>Section</code> indicates the specific part of the piece. Finally,
in this example we have <code>Clave_</code> column, which is a reference
to a clave pattern: strokes of the clave (woodblocks), whether sounded
or not, are noted here; there are normally 5 strokes per cycle. The
onset times for the instruments are recorded in seconds, although we
prefer to use milliseconds (ms) in the analyses of synchrony to avoid
reporting unnecessarily many digits. The onset times of the instruments
are the result of an automatic onset detection (that has been subjected
manual check) and the exact technique may depend on instrument used and
source of data.</p>
</div>
<div class="section level2">
<h2 id="add-annotations-for-cycles">Add annotations for cycles<a class="anchor" aria-label="anchor" href="#add-annotations-for-cycles"></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CSS_Song2_Metre</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_OSF_csv.html">get_OSF_csv</a></span><span class="op">(</span><span class="st">'4cdpr'</span><span class="op">)</span> <span class="co"># Annotations for cycles</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">CSS_Song2_Metre</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   Cycle      Time</span></span>
<span><span class="co">## 1     1  5.037333</span></span>
<span><span class="co">## 2     2  8.601000</span></span>
<span><span class="co">## 3     3 12.123000</span></span>
<span><span class="co">## 4     4 15.672000</span></span>
<span><span class="co">## 5     5 19.174500</span></span>
<span><span class="co">## 6     6 22.686000</span></span></code></pre>
<p>Let’s simplify this example (select only few columns).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CSS_Song2_Onset</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">CSS_Song2_Onset</span>,</span>
<span>                  <span class="va">Label.SD</span>,<span class="va">SD</span>,<span class="va">Clave</span>,<span class="va">Bass</span>,<span class="va">Guitar</span>,<span class="va">Tres</span><span class="op">)</span> </span></code></pre></div>
<p>In the second data frame (<code>CSS_Song2_Metre</code>), shown in
Table 2, we have annotations, namely the cycle times, which are the
manually-estimated times when the cycles start (containing all
sub-divisions of the beat). For instance, here the first cycle starts at
5.037333, the second cycle at 8.601000) and so on. This is important
information for some type of analyses and often we want to combine the
automatically detected onset times and the annotated cycles. It is
important to realise that the information about the cycles comes from an
annotation of the music by an expert (or in some cases by several
experts). To get an annotation such as this, software such <em>Sonic
Visualiser</em> can be used to tap with the perceived beats of the audio
track to obtain the beat times and then the first beat of the cycle is
manually labelled to the data. The sub-divisions are then inferred from
the cycle beginnings. This annotation process requires expertise with
the musical style in question as the same patterns of onsets could
potentially give rise to multiple interpretations of the metre.</p>
</div>
<div class="section level2">
<h2 id="combine-onsets-and-annotations">Combine onsets and annotations<a class="anchor" aria-label="anchor" href="#combine-onsets-and-annotations"></a>
</h2>
<p>As the onsets and annotations are in different files, we first
combine the onsets and annotations with <code>onsetsync</code>. Here we
first add annotations about the cycles into the onset data and then we
also add isochronous beat times to the data frame, since are useful
reference points for future calculations. The metre annotations have
already informed the allocation of onsets to beat positions; here we add
more information from the metre annotations to the dataframe to allow
further analysis options.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Add annotations about the cycle to the data frame</span></span>
<span><span class="va">CSS_Song2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_annotation.html">add_annotation</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">CSS_Song2_Onset</span>,</span>
<span>                            annotation <span class="op">=</span> <span class="va">CSS_Song2_Metre</span><span class="op">$</span><span class="va">Cycle</span>,</span>
<span>                            time <span class="op">=</span> <span class="va">CSS_Song2_Metre</span><span class="op">$</span><span class="va">Time</span>,</span>
<span>                            reference <span class="op">=</span> <span class="st">'Label.SD'</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="add-isochronous-beat-subdivisions-based-on-annotation">Add isochronous beat subdivisions based on annotation<a class="anchor" aria-label="anchor" href="#add-isochronous-beat-subdivisions-based-on-annotation"></a>
</h2>
<p>We add an isochronous reference subdivision of beat subdivisions
based on annotated cycle start times.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Add isochronous beats to the data frame</span></span>
<span><span class="va">CSS_Song2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_isobeats.html">add_isobeats</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">CSS_Song2</span>, </span>
<span>                          instr <span class="op">=</span> <span class="st">'CycleTime'</span>, </span>
<span>                          beat <span class="op">=</span> <span class="st">'SD'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">CSS_Song2</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">9</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   SD Clave     Bass   Guitar     Tres CycleTime Cycle Iso.Time</span></span>
<span><span class="co">## 1  1    NA       NA       NA       NA  5.037333     1 5.037333</span></span>
<span><span class="co">## 2  2    NA       NA 5.281932       NA        NA     1 5.260062</span></span>
<span><span class="co">## 3  3    NA       NA 5.480643       NA        NA     1 5.482792</span></span>
<span><span class="co">## 4  4    NA 5.714555 5.707537 5.730943        NA     1 5.705521</span></span>
<span><span class="co">## 5  5    NA 5.927078 5.939071 5.917083        NA     1 5.928250</span></span>
<span><span class="co">## 6  6    NA       NA 6.153243 6.144901        NA     1 6.150979</span></span></code></pre>
<p>At this point we have the basic elements for most analyses. In the
data frame <code>CSS_Song2</code> we have the onset data (coded under
instrument names, here <code>Clave</code>, <code>Bass</code>, and
<code>Tres</code>) and information about the beat cycles
(<code>CycleTime</code> and <code>Cycle</code>), and we also have timing
information for isochronous beat divisions (<code>Iso.Time</code>).</p>
<p>These annotation-based virtual beat structures can be systematically
off by a certain amount, so perhaps some it may be advantageous for some
analyses to infer the timing information related to the beat structure
from the existing onsets themselves and not rely on external reference.
<code>add_isobeats</code> function can accomplish this if given the
instruments from which it will calculate the mean onset time for the
first beat of the cycle, which will then be used to set the isochronous
beat timings for the rest of the beats within the cycle.</p>
</div>
<div class="section level2">
<h2 id="add-isochronous-beat-subdivisions-based-on-mean-onset-times">Add isochronous beat subdivisions based on mean onset times<a class="anchor" aria-label="anchor" href="#add-isochronous-beat-subdivisions-based-on-mean-onset-times"></a>
</h2>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Add isochronous beats based on mean timing of guitar, tres, and clave</span></span>
<span></span>
<span><span class="va">CSS_Song2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_isobeats.html">add_isobeats</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">CSS_Song2</span>, </span>
<span>                          instr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Guitar'</span>,<span class="st">'Tres'</span>,<span class="st">'Clave'</span><span class="op">)</span>, </span>
<span>                          beat <span class="op">=</span> <span class="st">'SD'</span><span class="op">)</span></span>
<span><span class="co"># Show the newly calculated isochronous beat times </span></span>
<span><span class="co"># from the second cycle onwards.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">CSS_Song2</span><span class="op">[</span><span class="fl">17</span><span class="op">:</span><span class="fl">22</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">6</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    SD     Tres CycleTime Cycle Iso.Time Mean.Time</span></span>
<span><span class="co">## 17  1 8.571167     8.601     2 8.601000  8.592649</span></span>
<span><span class="co">## 18  2       NA        NA     2 8.821125  8.803476</span></span>
<span><span class="co">## 19  3       NA        NA     2 9.041250  9.031986</span></span>
<span><span class="co">## 20  4 9.240644        NA     2 9.261375  9.257808</span></span>
<span><span class="co">## 21  5       NA        NA     2 9.481500  9.478042</span></span>
<span><span class="co">## 22  6 9.669264        NA     2 9.701625  9.670687</span></span></code></pre>
<p>These operations allow many to create a number of variant reference
points to be used in the calculation of synchrony.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Tuomas Eerola.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
